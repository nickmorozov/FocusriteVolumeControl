name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  # Override deployment target for CI runner compatibility
  MACOSX_DEPLOYMENT_TARGET: '15.0'
  # Skip code signing on CI
  CODE_SIGN_IDENTITY: ''
  CODE_SIGNING_REQUIRED: 'NO'
  CODE_SIGNING_ALLOWED: 'NO'

jobs:
  build-and-test:
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4

      - name: Build
        run: >
          xcodebuild -scheme FocusriteVolumeControl -configuration Debug
          MACOSX_DEPLOYMENT_TARGET=15.0
          CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO
          build

      - name: Test
        run: >
          xcodebuild test -scheme FocusriteVolumeControl -configuration Debug
          MACOSX_DEPLOYMENT_TARGET=15.0
          CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO
